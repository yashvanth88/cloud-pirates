# Secrets Checklist for Cloud Pirates (Civo CI/CD)

This file lists GitHub Actions repository secrets used by the `civo-deploy` workflow and the backend runtime, example formats, and quick verification commands.

--

## Required Secrets (names used in the workflow)

- `CIVO_API_KEY` — Civo API key for cluster creation and management.
  - Example: `civo_0123456789abcdef0123456789abcdef`

- `DATABASE_URL` — Postgres connection string used by migrations and runtime.
  - Example: `postgres://dbuser:securepass@db.example.com:5432/pirates_db`

- `SPACES_KEY` — S3/Spaces access key (object storage).
  - Example: `AKIAIOSFODNN7EXAMPLE`

- `SPACES_SECRET` — S3/Spaces secret key.
  - Example: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`

- `SPACES_ENDPOINT` — S3 endpoint (region or full URL).
  - Example: `https://nyc3.digitaloceanspaces.com`

- `SPACES_BUCKET` — Bucket/space name for storing scans.
  - Example: `pirates-scans`

- `REDIS_URL` — Redis connection string for the worker queue (BullMQ).
  - Example (no auth): `redis://127.0.0.1:6379`
  - Example (with password): `redis://:mypassword@redis.example.com:6379/0`

- `DOCKER_REGISTRY_USERNAME` — Username for container registry (if needed).
  - Example: `github` or your Docker Hub username

- `DOCKER_REGISTRY_PASSWORD` — Token/password for pushing container images.
  - Example (GHCR PAT): `ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXX`

Optional/inference & monitoring secrets

- `INFERENCE_URL` — External inference endpoint (Gemini/PaLM or custom).
  - Example: `https://api.example-inference.com/v1/predict`

- `INFERENCE_API_KEY` — API key for the inference provider.
  - Example: `sk-abcdef0123456789`

- `SENTRY_DSN` — Sentry data source name for error reporting (optional).
  - Example: `https://xxxx@sentry.io/123456`

--

## How to add these as GitHub Secrets

1. Open your repository on GitHub.
2. Go to `Settings` → `Secrets and variables` → `Actions` → `New repository secret`.
3. Add each secret using the exact names above (e.g., `CIVO_API_KEY`, `DATABASE_URL`).
4. After adding secrets, merge or push your branch to `main` to trigger the `civo-deploy` workflow, or manually trigger the workflow from the Actions tab.

Security notes

- Do not paste real secret values into chat or into source files.
- Limit access to repository secrets and rotate them periodically.

--

## Quick Local Verification Commands

Replace placeholders with your real (local/test) values when running these.

Test Postgres connectivity (requires `psql` installed):
```bash
export DATABASE_URL="postgres://dbuser:securepass@db.example.com:5432/pirates_db"
psql "$DATABASE_URL" -c '\l' || echo "DB connection failed"
```

Test Redis (requires `redis-cli`):
```bash
export REDIS_URL="redis://127.0.0.1:6379"
# For redis-cli v6+ use:
redis-cli -u "$REDIS_URL" PING
```

Test S3/Spaces access with AWS CLI:
```bash
export AWS_ACCESS_KEY_ID="SPACES_KEY"
export AWS_SECRET_ACCESS_KEY="SPACES_SECRET"
aws --endpoint-url "https://nyc3.digitaloceanspaces.com" s3 ls s3://pirates-scans || echo "S3/Spaces access failed"
```

Run migrations locally (from `backend/`):
```bash
export DATABASE_URL="postgres://dbuser:securepass@db.example.com:5432/pirates_db"
node migrate.js
```

Manually trigger GitHub Actions:

- Visit the repository Actions tab → select `civo-deploy` workflow → use `Run workflow` → choose `main` branch → Run.

--

## Next steps (recommended)

- Provision the services (Postgres, Redis, Spaces) in your cloud provider and note down their connection strings.
- Add the secrets above to the repo's GitHub Secrets.
- Optionally, store long-lived service credentials in your cloud provider's secrets manager and mount them into Kubernetes as `Secret` objects (manifest examples are in `k8s/`).

If you want, I can also create a `secrets-template.env` (no real secrets) to keep in the repo to track which secrets are required by the project.

--

Generated by the Cloud Pirates helper on request. Do not commit any real secret values.
